@*@model IList<News.Controllers.NewsController.Categories>*@
@using Domain.Core;
@using Domain.Core.Entity
@using Domain.Core.Enums
@model List<Domain.Core.Entity.NewsItem>
@{
    ViewBag.Title = "Index";
    var hasCategory = ViewBag.HasCategory != null && (bool)ViewBag.HasCategory;
    int i = 1;
}

@if (Request.IsAuthenticated && !hasCategory)
{
    <div class="modal fade" id="helloModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"></button>
                    <h4 class="modal-title">
                        Привіт! Це SenTime. Так, як ви завітали до нас перший раз, допоможіть нам підібрати для вас те, що вас цікавить.
                        Для цього виберіть нижче декілька категорій новин, якими ви цікавитесь.
                    </h4>
                </div>
                <div class="modal-body row">
                    @{
                        var arrayCater = Enum.GetNames(typeof(Category));
                    }
                    @foreach (var category in arrayCater)
                    {
                        <div class="col-md-4">
                            <input type="checkbox" id="@category" value="@category" class="checkCategory" />
                            <label for="@category">@category</label>
                        </div>
                    }
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default save-category" data-dismiss="modal">Гаразд</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            $("#helloModal").modal("show");
        });
    </script>
                        }
<br/>
<br/>
<div class="row">

    <div class="row row-flex row-flex-wrap">

        @foreach (var n in Model)
        {
            @Html.Partial("_NewsItem", n)
        }

    </div><!--/row-->
    <hr>

</div>


<script>
    $(document).ready(function () {
        $(".chooseCategories").click(function () {
            $("#modalCategories").modal('show');
        });

        @*$('.category').click(function () {
            var id = $(this).attr('data-id');
            var categoryName = $(this).text();
            $.ajax({
                url: '@Url.Action("GetSubCategories","News")',
                data: { id: id },
                method: 'post',
                type: "html",
                success: function (data) {
                    $("#modalCategories").modal('hide');
                    $(".body-for-subCategoties").html(data);
                    $('#modalSubCategories').modal('show');
                    $(".name-category").text(categoryName);
                }
            });
        });*@

            $(".close-sub-category").click(function () {
                $("#modalCategories").modal('show');
                $('#modalSubCategories').modal('hide');
            });
        });
    </script>
<!--Script references. -->
<!--Reference the jQuery library. -->
<!--Reference the SignalR library. -->
<script src="~/Scripts/jquery.signalR-2.2.2.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="/signalr/hubs"></script>
<!--Add script to update the page and send messages.-->
<script type="text/javascript">
    $(function () {
        // Declare a proxy to reference the hub.
        var chat = $.connection.newsHub;

        //var chatModel = { Id: 0, Name: '', Message: '' };
        var chatModel = "gegeg";

        // Create a function that the hub can call to broadcast messages.
        chat.client.broadcastMessage = function (model) {
            console.log("data");
            // Html encode display name and message.
            var encodedName = $('<div />').text(model.Name).html();
            var encodedMsg = $('<div />').text(model.Message+'\\'+model.Id).html();
            // Add the message to the page.
            $('#discussion').append('<li><strong>' + encodedName
                + '</strong>:&nbsp;&nbsp;' + encodedMsg + '</li>');
        };
        // Get the user name and store it to prepend to messages.
        //$('#displayname').val(prompt('Enter your name:', ''));
        // Set initial focus to message input box.
        $('#message').focus();
        // Start the connection.
        $.connection.hub.start().done(function () {
            //$('#sendmessage').click(function () {
            //    chatModel.Name = $('#displayname').val();
            //    chatModel.Message = $('#message').val();
                // Call the Send method on the hub.
                chat.server.send(chatModel);
                // Clear text box and reset focus for next comment.
                $('#message').val('').focus();
            //});
        });
    });
</script>